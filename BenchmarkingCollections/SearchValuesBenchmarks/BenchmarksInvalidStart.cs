using System.Buffers;
using System.Collections.Frozen;
using BenchmarkDotNet.Attributes;

namespace SearchValuesBenchmarks;

[MemoryDiagnoser()]
public class BenchmarksInvalidStart
{
    private static readonly char[] AllowedSymbolsArray =
    {
        'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N',
        'O', 'P', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9'
    };

    private static readonly HashSet<char> AllowedSymbolsHashSet = AllowedSymbolsArray.ToHashSet();

    private static readonly FrozenSet<char> AllowedSymbolsFrozenSet = AllowedSymbolsArray.ToFrozenSet();

    private static readonly SearchValues<char> AllowedSymbolsSearchValues = SearchValues.Create(AllowedSymbolsArray);
    
    [Params(
        "AFHB5^8AHBIF49GJCNSCYJKL234FZXCV",
        "AFHB58AHBIF49^GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCV",
        "AFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58^AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCV",
        "AFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBI^F49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCVAFHB58AHBIF49GJCNSCYJKL234FZXCV")]
    public string InvalidStringStart = null!;
    
    
    
    [Benchmark]
    public bool Naive_InValid_Start()
    {
        foreach (var ch in InvalidStringStart)
        {
            if (AllowedSymbolsArray.Contains(ch) is false)
                return false;
        }

        return true;
    }
    
    [Benchmark]
    public bool HashSet_InValid_Start()
    {
        foreach (var ch in InvalidStringStart)
        {
            if (AllowedSymbolsHashSet.Contains(ch) is false)
                return false;
        }

        return true;
    }
    
    [Benchmark]
    public bool FrozenSet_InValid_Start()
    {
        foreach (var ch in InvalidStringStart)
        {
            if (AllowedSymbolsFrozenSet.Contains(ch) is false)
                return false;
        }

        return true;
    }
    
    [Benchmark]
    public bool Span_InValid_Start()
    {
        return InvalidStringStart.AsSpan().IndexOfAnyExcept(AllowedSymbolsArray) is -1;
    }

    [Benchmark]
    public bool SearchValues_InValid_Start()
    {
        return InvalidStringStart.AsSpan().IndexOfAnyExcept(AllowedSymbolsSearchValues) is -1;
    }
}